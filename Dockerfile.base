FROM python:3.10

RUN apt-get update && apt-get install -y wget ca-certificates debian-archive-keyring && rm -rf /var/lib/apt/lists/*

RUN mkdir -p /usr/share/keyrings /etc/apt/sources.list.d && \
    wget -qO /usr/share/keyrings/adoptium.gpg https://packages.adoptium.net/artifactory/api/gpg/key/public && \
    echo 'Types: deb\nURIs: https://packages.adoptium.net/artifactory/deb\nSuites: bookworm\nComponents: main\nArchitectures: amd64\nTrusted: yes' \
    > /etc/apt/sources.list.d/adoptium.sources && \
    apt-get update && apt-get install -y \
    git \
    curl \
    wget \
    bzip2 \
    gcc-13 \
    g++-13 \
    temurin-11-jdk \
    build-essential \
    ca-certificates \
    libglib2.0-0 \
    libxext6 \
    libsm6 \
    libxrender1 \
    ffmpeg \
    libsm6 \
    libxext6 \
    && update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-13 60 --slave /usr/bin/g++ g++ /usr/bin/g++-13 \
    && rm -rf /var/lib/apt/lists/*

RUN curl -LsSf https://astral.sh/uv/install.sh | env UV_INSTALL_DIR="/astral/uv" sh
ENV PATH="/astral/uv/:${PATH}"

ARG AGENTGYM_REPO="https://github.com/WazupSteve/AgentGym.git"
ARG AGENTGYM_REF="main"
ENV AGENTGYM_HOME=/opt/agentgym
RUN git clone --depth=1 --branch "$AGENTGYM_REF" --recurse-submodules "$AGENTGYM_REPO" "$AGENTGYM_HOME"

CMD ["bash"]